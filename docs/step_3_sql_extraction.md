# インターネットTV (SQL)

## 1.エピソード視聴数トップ3のエピソードタイトルと視聴数を取得

```sql
SELECT title AS episode_title,
       view_count AS views
  FROM episodes
 ORDER BY view_count DESC
 LIMIT 3;
```

```shell
+--------------------------------+------------+
| title                          | view_count |
+--------------------------------+------------+
| 第13話 鬼との激闘              |     135000 |
| 第12話 最終決戦へ              |     130000 |
| 第11話 新たな鬼殺隊柱          |     125000 |
+--------------------------------+------------+
```

## 2.エピソード視聴数トップ3の番組タイトル、シーズン数、エピソード数、エピソードタイトル、視聴数を取得

```sql
SELECT p.title AS program_title,
       s.season_number AS season_number,
       e.episode_number AS episode_number,
       e.title AS episode_title,
       e.view_count AS views
  FROM episodes AS e
       JOIN programs AS p
       ON e.program_id = p.program_id

       JOIN seasons AS s
       ON e.season_id = s.season_id
 ORDER BY views DESC
 LIMIT 3;

```

```shell
+---------------+---------------+----------------+--------------------------------+--------+
| program_title | season_number | episode_number | episode_title                  | views  |
+---------------+---------------+----------------+--------------------------------+--------+
| 鬼滅の刃      |             2 | 13             | 第13話 鬼との激闘              | 135000 |
| 鬼滅の刃      |             2 | 12             | 第12話 最終決戦へ              | 130000 |
| 鬼滅の刃      |             2 | 11             | 第11話 新たな鬼殺隊柱          | 125000 |
+---------------+---------------+----------------+--------------------------------+--------+
```

## 3.本日放送される全ての番組に対して、チャンネル名、放送開始時刻(日付+時間)、放送終了時刻、シーズン数、エピソード数、エピソードタイトル、エピソード詳細を取得してください。なお、番組の開始時刻が本日のものを本日放送される番組とみなすものとします

```sql
SELECT ch.channel_name AS channel_name,
       br.start_time AS broadcast_start_datetime,
       br.end_time AS broadcast_end_datetime,
       s.season_number AS season_number,
       e.episode_number AS episode_number,
       e.title AS episode_title,
       e.description AS episode_description
  FROM broadcasts AS br
       JOIN channels ch
       ON br.channel_id = ch.channel_id

       JOIN episodes e
       ON br.episode_id = e.episode_id

       JOIN seasons s
       ON br.season_id = s.season_id
 WHERE DATE(br.start_time) = CURDATE();
```

```shell
| チャンネル          | 開始時刻            | 終了時刻            |シーズン| エピソード| タイトル                          | 説明               |
|---------------------|---------------------|---------------------|--------|-----------|-----------------------------------|--------------------|
| アニメチャンネル1   | 2023-11-11 05:00:00 | 2023-11-11 05:30:00 | 1      | 11        | 第11話 鬼殺隊の使命               | 鬼殺隊の新たな使命 |
| ドラマチャンネル1   | 2023-11-11 05:00:00 | 2023-11-11 05:30:00 | 1      | 3         | 第3話 新たな問題と障害に立ち向かう| 新たな問題への挑戦 |
| ドラマチャンネル1   | 2023-11-11 05:00:00 | 2023-11-11 05:30:00 | 1      | 3         | 第3話 新たな問題と障害に立ち向かう| 新たな問題への挑戦 |
```

## 4.ドラマのチャンネルに対して、放送開始時刻、放送終了時刻、シーズン数、エピソード数、エピソードタイトル、エピソード詳細を本日から一週間分取得してください

```sql
SELECT ch.channel_name AS broadcast_channel,
       br.start_time AS broadcast_start_time,
       br.end_time AS broadcast_end_time,
       s.season_number AS season_number,
       e.episode_number AS episode_number,
       e.title AS episode_title,
       e.description AS episode_description
  FROM broadcasts AS br
       JOIN channels AS ch
       ON br.channel_id = ch.channel_id

       JOIN seasons AS s
       ON br.season_id = s.season_id

       JOIN episodes AS e
       ON br.episode_id = e.episode_id
 WHERE ch.channel_name LIKE '%ドラマ%'
       AND DATE(br.start_time) BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 7 DAY);
```

```shell
| チャンネル        | 開始時刻            | 終了時刻            |シーズン|エピソード|タイトル                           | 説明                       |
|-------------------|---------------------|---------------------|--------|----------|-----------------------------------|----------------------------|
| アニメチャンネル1 | 2023-11-11 05:00:00 | 2023-11-11 05:30:00 | 1      | 11       |第11話 鬼殺隊の使命                | 鬼殺隊の新たな使命         |
| アニメチャンネル1 | 2023-11-12 05:30:00 | 2023-11-12 06:00:00 | 1      | 12       |第12話 鬼の棲む山                  | 鬼の棲む山への挑戦         |
| アニメチャンネル1 | 2023-11-13 06:00:00 | 2023-11-13 06:30:00 | 1      | 13       |第13話 獣の魔術                    | 獣との魔術の闘い           |
| アニメチャンネル1 | 2023-11-14 06:30:00 | 2023-11-14 07:00:00 | 1      | 14       |第14話 鬼舞辻無惨                  | 最強鬼・無惨との対決       |
| アニメチャンネル1 | 2023-11-15 07:00:00 | 2023-11-15 07:30:00 | 1      | 15       |第15話 新たな修行                  | さらなる修行と成長         |
| アニメチャンネル1 | 2023-11-16 07:30:00 | 2023-11-16 08:00:00 | 1      | 16       |第16話 鬼殺隊の試練                | 鬼殺隊の新たな試練         |
| アニメチャンネル1 | 2023-11-17 08:00:00 | 2023-11-17 08:30:00 | 1      | 17       |第17話 蝶屋敷の謎                  | 謎の蝶屋敷への探索         |
| アニメチャンネル1 | 2023-11-18 08:30:00 | 2023-11-18 09:00:00 | 1      | 18       |第18話 鬼との再戦                  | 再びの鬼との壮絶な戦い     |
| アニメチャンネル2 | 2023-11-12 05:00:00 | 2023-11-12 05:30:00 | 2      | 5        |第5話 剣士たちの修行               | 剣士たちの厳しい修行       |
| アニメチャンネル2 | 2023-11-13 05:30:00 | 2023-11-13 06:00:00 | 2      | 6        |第6話 鬼との再戦                   | 再びの鬼との戦闘           |
| アニメチャンネル2 | 2023-11-14 06:00:00 | 2023-11-14 06:30:00 | 2      | 7        |第7話 新たな鬼殺隊士               | 新たな鬼殺隊士たち         |
| アニメチャンネル2 | 2023-11-15 06:30:00 | 2023-11-15 07:00:00 | 2      | 8        |第8話 鬼の脅威再び                 | 鬼の新たな脅威             |
| アニメチャンネル2 | 2023-11-16 07:00:00 | 2023-11-16 07:30:00 | 2      | 9        |第9話 柱合会議                     | 柱合会議と新たな使命       |
| アニメチャンネル2 | 2023-11-17 07:30:00 | 2023-11-17 08:00:00 | 2      | 10       |第10話 鬼殺隊再編                  | 鬼殺隊の再編成             |
| アニメチャンネル2 | 2023-11-18 08:00:00 | 2023-11-18 08:30:00 | 2      | 11       |第11話 新たな鬼殺隊柱              | 新たな鬼殺隊柱たち         |
| ドラマチャンネル1 | 2023-11-11 05:00:00 | 2023-11-11 05:30:00 | 1      | 3        |第3話 新たな問題と障害に立ち向かう | 新たな問題への挑戦         |
| ドラマチャンネル1 | 2023-11-12 05:30:00 | 2023-11-12 06:00:00 | 1      | 4        |第4話 仕事と家庭のバランスを取る   | 仕事と家庭のバランスの探求 |
| ドラマチャンネル1 | 2023-11-13 06:00:00 | 2023-11-13 06:30:00 | 1      | 5        |第5話 友情と結婚生活の葛藤         | 友情と結婚生活の葛藤       |
| ドラマチャンネル1 | 2023-11-14 06:30:00 | 2023-11-14 07:00:00 | 1      | 6        |第6話 新たな家族問題の発生         | 新たな家族問題の発生       |
| ドラマチャンネル1 | 2023-11-15 07:00:00 | 2023-11-15 07:30:00 | 1      | 7        |第7話 夫婦関係の変化               | 夫婦関係の変化             |
| ドラマチャンネル1 | 2023-11-16 07:30:00 | 2023-11-16 08:00:00 | 1      | 8        |第8話 家庭内外の新たな展開         | 家庭内外の新たな展開       |
| ドラマチャンネル1 | 2023-11-17 06:00:00 | 2023-11-17 06:30:00 | 1      | 9        |第9話 家族との絆を深める           | 家族との絆を深める         |
| ドラマチャンネル1 | 2023-11-18 06:30:00 | 2023-11-18 07:00:00 | 1      | 10       |第10話 未来への希望                | 最終回                     |
| ドラマチャンネル2 | 2023-11-11 05:00:00 | 2023-11-11 05:30:00 | 1      | 3        |第3話 新たな問題と障害に立ち向かう | 新たな問題への挑戦         |
| ドラマチャンネル2 | 2023-11-12 05:30:00 | 2023-11-12 06:00:00 | 1      | 4        |第4話 仕事と家庭のバランスを取る   | 仕事と家庭のバランスの探求 |
| ドラマチャンネル2 | 2023-11-13 06:00:00 | 2023-11-13 06:30:00 | 1      | 5        |第5話 友情と結婚生活の葛藤         | 友情と結婚生活の葛藤       |
| ドラマチャンネル2 | 2023-11-14 06:30:00 | 2023-11-14 07:00:00 | 1      | 6        |第6話 新たな家族問題の発生         | 新たな家族問題の発生       |
| ドラマチャンネル2 | 2023-11-15 07:00:00 | 2023-11-15 07:30:00 | 1      | 7        |第7話 夫婦関係の変化               | 夫婦関係の変化             |
| ドラマチャンネル2 | 2023-11-16 07:30:00 | 2023-11-16 08:00:00 | 1      | 8        |第8話 家庭内外の新たな展開         | 家庭内外の新たな展開       |
| ドラマチャンネル2 | 2023-11-17 06:00:00 | 2023-11-17 06:30:00 | 1      | 9        |第9話 家族との絆を深める           | 家族との絆を深める         |
| ドラマチャンネル2 | 2023-11-18 06:30:00 | 2023-11-18 07:00:00 | 1      | 10       |第10話 未来への希望                | 最終回                     |
31 rows in set (0.00 sec)
```

## 5.直近一週間に放送された番組の中で、エピソード視聴数合計トップ2の番組に対して、番組タイトル、視聴数を取得してください

```sql
SELECT p.title AS program_name,
       e.title AS episode_title,
       br.view_count AS views
  FROM broadcasts br
       JOIN episodes e
       ON br.episode_id = e.episode_id

       JOIN programs p
       ON e.program_id = p.program_id
 WHERE br.start_time BETWEEN CURDATE() AND DATE_ADD(CURDATE(), INTERVAL 7 DAY)
 ORDER BY views DESC
 LIMIT 2;
```

```shell
+-----------------------------------+-------------------------------------+--------+
| program_name                      | episode_title                       | views  |
+-----------------------------------+-------------------------------------+--------+
| 鬼滅の刃                          | 第17話 蝶屋敷の謎                   | 170000 |
| 逃げるは恥だが役に立つ            | 第9話 家族との絆を深める            | 160000 |
+-----------------------------------+-------------------------------------+--------+
2 rows in set (0.00 sec)
```

## 6.ジャンルごとの番組の視聴数ランキングを知りたいです。番組の視聴数ランキングはエピソードの平均視聴数ランキングとします。 ジャンルごとに視聴数トップの番組に対して、ジャンル名、番組タイトル、エピソード平均視聴数を取得してください。直近一週間に放送された番組の中で、エピソード視聴数合計トップ2の番組に対して、番組タイトル、視聴数を取得してください

```sql
SELECT g.genre_name AS genre_name,
       p.title AS program_title,
       AVG(e.view_count) AS average_episode_views
  FROM genres g
       JOIN genre_registries gr
       ON g.genre_id = gr.genre_id

       JOIN programs p
       ON gr.program_id = p.program_id

       JOIN episodes e
       ON p.program_id = e.program_id
 GROUP BY genre_name, program_title
 ORDER BY average_episode_views DESC;
```

```shell
+-----------------+-----------------------------------+-----------------------+
| genre_name      | program_title                     | average_episode_views |
+-----------------+-----------------------------------+-----------------------+
| アニメ          | 鬼滅の刃                          |           108128.2051 |
| アクション      | 鬼滅の刃                          |           108128.2051 |
| ドラマ          | 逃げるは恥だが役に立つ            |                0.0000 |
+-----------------+-----------------------------------+-----------------------+
3 rows in set (0.00 sec)
```
